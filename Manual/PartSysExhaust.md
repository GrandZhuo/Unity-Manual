<!-- # Exhaust Smoke from a Vehicle -->
# 载具尾气

<!-- Cars and many other vehicles emit exhaust smoke as they convert fuel into power. You can use a particle system to add an exhaust as a nice finishing touch for a vehicle. -->

汽车和其他载具将燃油转换为动力时会排放废气。你可以使用粒子系统画龙点睛地为车辆添加尾气效果。

![An exhaust generated by a particle system](https://docs.unity3d.com/uploads/Main/PartSysExhaustScreenshot.png)
<!-- > An exhaust generated by a particle system -->
> 粒子系统产生的排气效果

<!-- ## Timeline of a Particle -->
## 粒子的时间轴

<!-- Exhaust smoke emerges from the pipe quite fast but then rapidly slows down on contact with the atmosphere. As it slows, it spreads out, becoming fainter and soon dissipating into the air. Since the exhaust gas is hot, it also rises slightly as it passes through the colder air surrounding it. -->

废气烟雾从管道中快速排出，随后在与大气接触时迅速减慢移动速度。随着减慢，它向四周散开，并变得更加模糊，然后快速消散在空气中。因为废气是热的，它在穿过周围的冷空气时会轻微地上浮。

<!-- A particle of exhaust smoke must start off no larger than the width of the pipe but it will then grow in size considerably over its short lifetime. It will usually start off partly transparent and fade to total transparency as it mixes with the air. As regards dynamics, the particle will be emitted quite fast but then slow rapidly and will also lift upward slightly. -->

废气烟雾粒子的初始大小不能大于排气管的宽度，但是在它短短的生命周期内，它的大小将大大增加。它通常从半透明开始，随着它与空气混合，将淡出到完全透明。至于动力学，粒子将非常快速地发射，然后快速减慢，并略微上浮。

<!-- ## Implementation -->
## 实现

<!-- In the _Shape_ module, select the _Cone_ shape and set its _Angle_ property to zero; the “cone” in this case will actually be a cylindrical pipe. The _Radius_ of the pipe naturally depends on the size of the vehicle but you can usually set it by matching the radius Gizmo in the scene view to the vehicle model (eg, a car model will usually feature an exhaust pipe or a hole at the back whose size you can match). The radius actually determines quite a few things about the property settings you choose, such as the particle size and emission rate. For the purposes of this example, we will assume the vehicle is a car which follows Unity’s standard size convention of one world unit to one metre; the radius is thus set to about 0.05 or 5cm. -->

在 _形状 Shape_ 模块中，选择 _圆锥体 Cone_ 形状，并设置它的 _角度 Angle_ 属性 为 0；这里的『圆锥体』实际上是圆柱形的管道。管道的 _半径 Radius_ 取决于实际车辆的大小，不过，通常你可以在场景视图中，让半径线框与车辆模型相匹配（例如，汽车模型通常具有一个排气管，或是在后面有一个洞，你可以匹配排气管或的大小）。半径实际上决定了很多属性的设置，例如粒子大小和发射率。在这个示例中，我们假设载具是一辆遵循 Unity 标准尺寸约定（1 单位等于 1 米）的汽车；因此设置半径为约 0.05 或 5 厘米。

<!-- A suitable graphic for the smoke particle is provided by the _Smoke4_ material provided in the standard assets. If you don’t already have these installed then select **Assets > Import Package > Particles** from the menu. Then, go to the _Renderer_ module of the particle system and set the Material property to Smoke4. -->

标准资源提供的 _Smoke4_ 材质很适合作为烟雾粒子的图形。如果尚未安装这些资源，那么从菜单中选择 **Assets > Import Package > Particles**。然后，进入粒子系统的 _渲染器 Renderer_ 模块，设置 _材质 Material_ 为 _Smoke4_.

<!-- The default lifetime of five seconds is generally too long for car exhaust fumes, so you should open the Particle System module (which has the same name as the GameObject, eg, “Exhaust”) and set the _Start Lifetime_ to about 2.5 seconds. Also in this module, set the _Simulation Space_ to _World_ and the _Gravity Modifier_ to a small negative value, say about –0.1. Using a world simulation space allows the smoke to hang where it is produced even when the vehicle moves. The negative gravity effect causes the smoke particles to rise as if they are composed of hot gas. A nice extra touch is to use the small menu arrow next to _Start Rotation_ to select the _Random Between Two Constants_ option. Set the two values to 0 and 360, respectively, and the smoke particles will be randomly rotated as they are emitted. Having many particles that are identically aligned is very noticeable and detracts from the effect of a random, shapeless smoke trail. -->

对于汽车尾气，默认的 5 秒生命周期通常太长了，因此你应该打开 Particle System 模块（与游戏对象同名，例如『Exhaust』），设置 _初始生命周期 Start Lifetime_ 为 2.5 秒。还是在这个模块中，设置 _模拟空间 Simulation Space_ 为 _世界 World_，设置 _重力修改器 Gravity Modifier_ 为一个小的负值，比如 –0.1。使用世界模拟空间，是为了使烟雾悬浮在其产生的位置，即使是在载具行驶时。负重力效应使烟雾粒子上浮，就像它们是由热气体构成的。还是一个点睛之笔是，点击 _初始渲染 Start Rotation_ 旁边的小菜单箭头，选择 _在两个常量之间随机 Random Between Two Constants_ 选项。将这两个值分别设置为 0 和 360，烟雾粒子将在发射时随机旋转。许多完全相同的粒子排列在一起太不自然了，不利于生成随机的、无形的烟雾轨迹。

<!-- At this stage, the smoke particles are starting to look realistic and the default emission rate creates a nice “chugging” effect of an engine. However, the smoke doesn’t billow outwards and dissipate as yet. Open the _Color Over Lifetime_ module and click the top gradient stop on the right hand end of the gradient (this controls the transparency of “alpha” value of the color). Set the alpha value to zero and you should see the smoke particles fading to nothing in the scene. Depending on how clean your engine is, you may also want to reduce the alpha value of the gradient at the start; thick, dark smoke tends to suggest dirty, inefficient combustion. -->

在这个阶段，烟雾粒子开始看起是真实的，默认的发射率很好地产生了发动机的间歇性燃烧效果。不过，烟雾没有向外膨胀，也没有消失。开启 _随生命周期改变颜色 Color Over Lifetime_ 模块，点击渐变面板右端顶部的按钮（控制颜色 alpha 值的透明度）。设置 alpha 值为 0，你应该在场景视图中看到烟雾粒子消失不见。根据发动机的清洁程序，你可能想要降低开始时的渐变透明度；厚重的、黑色的颜色暗示了肮脏的、低效的燃烧。

<!-- As well as fading, the smoke should also increase in size as it escapes and you can easily create this effect with the _Size Over Lifetime_ module. Open the module, select the curve and slide the curve handle at the left hand end to make the particles start off at a fraction of their full size. The exact size you choose depends on the size of the exhaust pipe but a value slightly larger than the pipe gives a good impression of escaping gas. (Starting the particles at the same size as the pipe suggests that the gas is being held to its shape by the pipe but of course, gas doesn’t have a defined shape.) Use the simulation of the particle system in the scene view to get a good visual impression of how the smoke looks. You may also want to increase the _Start Size_ in the particle system module at this point if the smoke doesn’t disperse far enough to create the effect you want. -->

除了淡出，烟雾还应该在逃逸过程中增加大小，使用 _随生命周期改变大小 Size Over Lifetime_ 模块可以很容易地创建这种效果。启用这个模块，选中曲线，滑动左端的曲线手柄，使粒子的初始大小为完整尺寸的一小部分。粒子的实际大小取决于排气管的大小，但是，比排气管稍大的值，可以创建更好的气体溢出效果。（如果粒子的初始大小与排气管相同，将暗示气体的形状被排气管所限制，但气体根本并没有固定的形状。）可以在场景视图中看到，粒子系统很好地模拟了烟雾的视觉效果。如果创建的烟雾扩散效果不符合预期，你可能还需要在粒子系统模块中增加 _初始大小 Start Size_。

<!-- Finally, the smoke should also slow down as it disperses. An easy way to make this happen is with the _Force Over Lifetime_ module. Open the module and set the _Space_ option to _Local_ and the Z component of the force to a negative value to indicate that the particles are pushed back by the force (the system emits the particles along the positive Z direction in the object’s local space). A value of about –0.75 works quite well for the system if the other parameters are set up as suggested above. -->

最后一点，烟雾将随着扩展而减慢速度。一个简单的实现方式是使用 _随时间改变作用力 Force Over Lifetime_ 模块。启用这个模块，设置 _空间 Space_ 选项为 _本地 Local_，设置作用力组件 Z 为一个负值，表示粒子被作用力回推（系统沿着对象本地空间的正 Z 方向发射粒子）。如果按照前文所述设置其他参数，那么设置为约 –0.75，粒子系统将很好地运行。

<!-- ## Usage -->
## 用法

<!-- You can position the exhaust particle system by placing it on a child object of the main vehicle. For simple games, you can just enable the _Play On Awake_ and _Looping_ properties and let the system run. In most cases, however, you will probably want to vary at least the emission rate as the vehicle moves. This is firstly for authenticity (ie, an engine produces more smoke as it works harder) but it also helps to prevent the smoke particles from being spread out as the vehicle moves. A fast-moving vehicle with too low an emission rate will appear to produce distinct “puffs” of smoke, which is highly unrealistic. -->

你可以将尾气粒子系统添加到载具的某个子对象上来定位它。对于简单的游戏，你可以开启 _唤醒时播放 Play On Awake_ 和 _循环播放 Looping_，让粒子系统开始运行。然而大多数情况下，你可能至少需要改变载具行驶时的反射速率。这么做首先是为了真实性（例如，引擎在剧烈运转时产生更多的烟雾），其次还可以避免烟雾粒子随着载具行驶而散开。一个快速移动的载具，如果发射率太低，将产生一股一股的烟雾，非常不真实。

<!-- You can vary the emission rate very easily from a script. If you have a variable in the script that represents the engine revs or the speed of the vehicle then you can simply multiply this value by a constant and assign the result to the ParticleSystem’s emissionRate property. -->

通过脚本，可以非常容易地改变发射率。如果脚本中的某个变量代表了引擎的转速或载具的速度，那么你可以简单地地把它的值乘以一个常数，并把计算结果分配给粒子系统的 `emissionRate` 属性。


```cs
    // C#

    using UnityEngine;
    using System.Collections;

    public class PartScriptTestCS : MonoBehaviour {

        public float engineRevs;
        public float exhaustRate;

        ParticleSystem exhaust;

        void Start () {
            exhaust = GetComponent<ParticleSystem>();
        }

        void Update () {
            exhaust.emissionRate = engineRevs * exhaustRate;
        }

    }
```

```js
    // JS

    var engineRevs: float;
    var exhaustRate: float;

    var exhaust: ParticleSystem;

    function Start() {
        exhaust = GetComponent.<ParticleSystem>();
    }

    function Update () {
        exhaust.emissionRate = engineRevs * exhaustRate;
    }
```

<!-- ## Further Ideas -->
## 更进一步

<!-- The basic scheme creates quite a convincing impression of exhaust smoke but you will probably have noticed that the “character” of the engine changes as you vary the parameters. An poorly tuned, inefficient engine tends to burn its fuel incompletely, resulting in heavy, dark smoke that persists for a long time in the air. This would be perfect for an old farm tractor but not for a high-performance sports car. For a “clean” engine, you should use small values for the lifetime, opacity and size increase of the particles. For a “dirty” engine, you should increase these values and perhaps use the _Bursts_ property of the _Emission_ module to create the impression of the engine spluttering. -->

基本方案创建了相当逼真的尾气效果，不过你可能已经注意到，引擎的『特性』随着参数的改变而改变。一个缺乏维护的、低效率的引擎将不完全地燃烧燃料，产生浓厚的、黑暗的烟雾，并长时间存在于空气中。这种效果很适合老旧的农用拖拉机，但是不适合高性能的运动跑车。对于清洁的发动机，你应该为粒子的生命周期、透明度和大小增量设置更小的值。对于『肮脏』的引擎，你应该增大这些值，可能还会使用 _发射 Emission_ 模块的 _脉冲 Bursts_ 属性，来创建引擎噼啪响的效果。
